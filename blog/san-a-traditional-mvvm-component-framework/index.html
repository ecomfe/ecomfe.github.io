<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width,
                   height=device-height,
                   initial-scale=1.0,
                   maximum-scale=1.0,
                   user-scalable=no"
    />
    <meta name="author"
          content="ecomfe">
    
    
    <title>San - 一个传统的MVVM组件框架 | EFE Tech</title>
    

    <link rel="stylesheet" href="/css/page.css">
    <link rel="stylesheet" href="/css/code.css">
    <link rel="stylesheet" href="/css/font-awesome.css">
</head>
<body>

<aside>
    <a class="home" href="/" title="EFE Home"><abbr title="EFE">EFE</abbr></a>
    <nav>
        <a href="https://github.com/ecomfe/spec" target="_blank">SPECS</a>
        <a href="/projects/">PROJECTS</a>
        <!--a href="/about.html">ABOUT</a-->
    </nav>
    <ul class="product-overview">
        <li><a target="_blank" href="https://ecomfe.github.io/san/"> <span class="product-overview-title">SAN</span> <span class="product-overview-desc">- MVVM 组件框架</span></a></li>
        <li><a target="_blank" href="http://fecs.baidu.com/"> <span class="product-overview-title">FECS</span> <span class="product-overview-desc">- 前端代码风格检查套件</span></a></li>
        <li><a target="_blank" href="http://echarts.baidu.com/"> <span class="product-overview-title">ECharts</span> <span class="product-overview-desc">- 数据可视化图表库</span></a></li>
        <li><a target="_blank" href="https://github.com/ecomfe/esl"><span class="product-overview-title">ESL</span> <span class="product-overview-desc"> - AMD Loader</span></a></li>
        <li><a target="_blank" href="http://ecomfe.github.io/edp/"><span class="product-overview-title">EDP</span> <span class="product-overview-desc"> - 前端开发平台</span></a></li>
        <li><a target="_blank" href="http://ecomfe.github.io/est/"><span class="product-overview-title">EST</span> <span class="product-overview-desc"> - 基于 Less 的样式工具库</span></a></li>
        <li><a target="_blank" href="http://ecomfe.github.io/saber/"><span class="product-overview-title">Saber</span> <span class="product-overview-desc"> - 移动 SPA 项目解决方案</span></a></li>
        <li><a target="_blank" href="http://ecomfe.github.io/saber/"><span class="product-overview-title">Rebas</span> <span class="product-overview-desc"> - 基于 NodeJS 的同构解决方案</span></a></li>
        <li><a target="_blank" href="https://github.com/ecomfe/rider"><span class="product-overview-title">Rider</span> <span class="product-overview-desc"> - 移动样式工具库</span></a></li>
        <li><a target="_blank" href="https://github.com/ecomfe/er"><span class="product-overview-title">ER</span> <span class="product-overview-desc"> - SPA 应用框架</span></a></li>
        <li><a target="_blank" href="https://github.com/ecomfe/esui"><span class="product-overview-title">ESUI</span> <span class="product-overview-desc"> - UI 组件库</a></span></li>
        <li><a target="_blank" href="http://ecomfe.github.io/etpl/"><span class="product-overview-title">ETpl</span> <span class="product-overview-desc"> - 灵活、高性能的模板引擎</span></a></li>
        <li><a target="_blank" href="https://github.com/BE-FE/iSlider"><span class="product-overview-title">iSlider</span> <span class="product-overview-desc"> - 轻量、高性能的移动滑动方案</span></a></li>
        <li><a target="_blank" href="http://tushuo.baidu.com/"><span class="product-overview-title">图说</span> <span class="product-overview-desc"> - 可视化数据分享平台</span></a></li>
        <li><a target="_blank" href="http://ecomfe.github.io/fontmin"><span class="product-overview-title">Fontmin</span> <span class="product-overview-desc"> - 首个纯 JS 字体子集化方案</span></a></li>
    </ul>
    <p class="efe-desc">百度EFE（Excellent FrontEnd）技术体系，前身是ECOM前端团队，后经过技术的发展，逐渐形成一套完善的前端技术体系。<br><br>EFE技术体系现由多个遵循该技术体系的前端团队所组成。E(Excellent)代表我们追求卓越的技术态度。</p>

    
    <dl class="tags">
        <dt>Tags</dt>
        
            <dd><a href="/tags/JavaScript/">JavaScript</a> <small>(30)</small></dd>
        
            <dd><a href="/tags/ECharts/">ECharts</a> <small>(20)</small></dd>
        
            <dd><a href="/tags/数据可视化/">数据可视化</a> <small>(17)</small></dd>
        
            <dd><a href="/tags/模块化/">模块化</a> <small>(9)</small></dd>
        
            <dd><a href="/tags/CSS/">CSS</a> <small>(8)</small></dd>
        
            <dd><a href="/tags/教程/">教程</a> <small>(7)</small></dd>
        
            <dd><a href="/tags/AMD/">AMD</a> <small>(6)</small></dd>
        
            <dd><a href="/tags/新版本/">新版本</a> <small>(6)</small></dd>
        
            <dd><a href="/tags/ESNext/">ESNext</a> <small>(6)</small></dd>
        
            <dd><a href="/tags/Lint/">Lint</a> <small>(4)</small></dd>
        
            <dd><a href="/tags/MVVM/">MVVM</a> <small>(4)</small></dd>
        
            <dd><a href="/tags/Mobile/">Mobile</a> <small>(4)</small></dd>
        
            <dd><a href="/tags/font/">font</a> <small>(4)</small></dd>
        
            <dd><a href="/tags/San/">San</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/ES6/">ES6</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/HTML/">HTML</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/优化/">优化</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/NodeJS/">NodeJS</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/React-Native/">React Native</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/Hint/">Hint</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/图片/">图片</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/tool/">tool</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/promise/">promise</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/IoC/">IoC</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/用户体验/">用户体验</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/地图/">地图</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/ESL/">ESL</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/中文字体/">中文字体</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/GL/">GL</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/Less/">Less</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/重构/">重构</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/practice/">practice</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/fixed/">fixed</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/设计/">设计</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/mixin/">mixin</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/React/">React</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/JS-Engine/">JS Engine</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/Objective-C/">Objective C</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/DI/">DI</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/Check/">Check</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/依赖注入/">依赖注入</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/OO/">OO</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Isomorphic/">Isomorphic</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/可视分析/">可视分析</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/高阶组合/">高阶组合</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Layout/">Layout</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/硬件加速/">硬件加速</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Hardware-Accelerated/">Hardware Accelerated</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/subtree/">subtree</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/submoudle/">submoudle</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/git/">git</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Saucelabs/">Saucelabs</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/1px/">1px</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/tesing/">tesing</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Travis-CI/">Travis CI</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/HTTP/">HTTP</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/REST/">REST</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/float/">float</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/ETpl/">ETpl</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/模板引擎/">模板引擎</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/弹性滚动/">弹性滚动</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/MVC/">MVC</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/beautify/">beautify</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/fix/">fix</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/format/">format</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/check/">check</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/MVP/">MVP</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/构建/">构建</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/3D/">3D</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/ECharts-X/">ECharts-X</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Ionic/">Ionic</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/SPA/">SPA</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/水球图/">水球图</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/直方图/">直方图</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Number/">Number</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/IEEE-754/">IEEE_754</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/iOS/">iOS</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/字体/">字体</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/图标/">图标</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/SVG/">SVG</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/sticky/">sticky</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/响应式/">响应式</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/预处理器/">预处理器</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/工具疲劳/">工具疲劳</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Sass/">Sass</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Stylus/">Stylus</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/文本截断/">文本截断</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/ellipsis/">ellipsis</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/text-overflow/">text-overflow</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/algorithm/">algorithm</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/VitualDOM/">VitualDOM</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Preact/">Preact</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/扩展性/">扩展性</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/高阶函数/">高阶函数</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/forEach/">forEach</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/baidu网盘/">baidu网盘</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Android/">Android</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/venn/">venn</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/VIM/">VIM</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Completion/">Completion</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/color/">color</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/前端设计感/">前端设计感</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/windows/">windows</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/XHR/">XHR</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/baidubce/">baidubce</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Coveralls/">Coveralls</a> <small>(1)</small></dd>
        
    </dl>


        <dl class="links">
        <dt>Links</dt>
        <dd><a target="_blank" href="http://fex.baidu.com/">Baidu FEX</a></dd>
        <dd><a target="_blank" href="http://eux.baidu.com/">Baidu EUX</a></dd>
        <dd><a target="_blank" href="http://ued.taobao.org/blog/">Taobao UED</a></dd>
        <dd><a target="_blank" href="http://www.alloyteam.com/">Tencent AlloyTeam</a></dd>
        <dd><a target="_blank" href="http://isux.tencent.com/">Tencent ISUX</a></dd>
        <dd><a target="_blank" href="http://ued.ctrip.com/blog/?cat=11">CTrip UED</a></dd>
        <dd><a target="_blank" href="http://www.75team.com/">75Team</a></dd>
    </ul>

</aside>

<article>
    
        <h1>San - 一个传统的MVVM组件框架</h1>
    

    <div class="article-meta">
        <span class="article-author"><i class="fa fa-pencil"></i>
    
        <a target="_blank" href="http://errorrik.com/" title="errorrik">errorrik</a>
    
</span>

        <time datetime="2017-06-21T16:00:00.000Z" itemprop="datePublished"><i class="fa fa-clock-o"></i> 2017-06-22</time>

        
    
    <span class="article-tags"><i class="fa fa-tag"></i> <a href="/tags/MVVM/">MVVM</a>, <a href="/tags/San/">San</a></span>


    </div>

    
        <p><img src="/blog/san-a-traditional-mvvm-component-framework/logo.svg" height="220"></p>
<p>这一年多来，其实受到过不少质疑，比如“咦，你们又在发明轮子了？”。每当此时我只能嘿嘿嘿一笑，毕竟你做的东西看起来还只是个垃圾而已，而看起来我们有很多成熟的东西可以选了：<a href="https://vuejs.org/" target="_blank" rel="noopener">Vue</a>、<a href="https://facebook.github.io/react/" target="_blank" rel="noopener">React</a>、<a href="https://angular.io/" target="_blank" rel="noopener">Angular</a>、<a href="https://www.polymer-project.org/" target="_blank" rel="noopener">Polymer</a>等等。在今天，我们觉得 <a href="https://ecomfe.github.io/san/" target="_blank" rel="noopener">San</a> 经过了一些项目的验证（踩坑）和进化（填坑），能够出来见人时，我们打算出来说说为啥要造轮子，造的是个啥样的轮子。</p>
<p>根据厚脸皮的惯例，先求Star。接下来是广告，可能你能从广告里得到一点启发。</p>
<iframe src="https://ghbtns.com/github-btn.html?user=ecomfe&amp;repo=san&amp;type=star&amp;count=true" frameborder="0" scrolling="0" width="170px" height="20px">
</iframe>
<h3 id="为什么要做-san">为什么要做 San</h3>
<p><a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93viewmodel" target="_blank" rel="noopener">MVVM</a> 并不是什么新鲜事物，在 Web 上的应用我们也远不是先驱。从几年前，我们有些团队在 <a href="https://angular.io/" target="_blank" rel="noopener">Angular</a>1 开始一些实践，也有些团队接触了 <a href="https://facebook.github.io/react/" target="_blank" rel="noopener">React</a>，但是让我印象最深刻的还是 <a href="https://vuejs.org/" target="_blank" rel="noopener">Vue</a>，并不是因为多高深的技术，而是因为真的“好用”。我们在一些要求不那么高（兼容性、性能等）的应用中实践一些流行技术，并享受一些便利。将近2年前，我们对实践过的东西进行了一些总结，有些东西已经比较常识了：</p>
<ul>
<li>组件化</li>
<li>声明式视图</li>
<li>view=f(data)</li>
<li>数据到视图的渲染引擎</li>
<li>异步渲染</li>
<li>......</li>
</ul>
<a id="more"></a>
<p>但是由于 IE8- 占有率仍然可观，在 to C 的应用中，我们只能老老实实的 <a href="http://jquery.com/" target="_blank" rel="noopener">JQuery</a>、挨个 DOM 操作。兼容性是横在我们面前最大的问题。随着时间流逝，总有一天兼容性将不再是问题，但你真的要等到几年后所有落后都淘汰吗？任何时候我们都会发现有一些东西将要被淘汰，有一些东西将要来，但如果你站着不动，还不如去当一块叉烧咯。</p>
<p>说白了，不折腾会死的精神让我们开了新坑，初衷仅仅是因为 <strong>兼容性</strong> ，这种看起来不大又可笑的理由。但是它确实绕不开，它也可能会带来其他问题，比如移动端和PC端无法使用相同的组件架构。</p>
<h3 id="为什么叫-san">为什么叫 San</h3>
<p>在 2010 年左右，为了应对 SPA 类型的各种业务系统，我们写了个 MVC 的框架叫 ER（Enterprise RIA），看起来是个 2。主席<a href="https://www.zhihu.com/people/justineo/answers" target="_blank" rel="noopener">Justineo</a>说既然新坑要比老坑更先进，那就叫 3 吧。一帮起名困难症患者觉得貌似很有道理，于是就这么定了。</p>
<p>所以 San 不是什么的缩写，就是 3 而已......虽然名字很随意，但是造轮子的过程我们是认真的</p>
<h3 id="把-san-做成什么样">把 San 做成什么样</h3>
<p>既然要自己做了，那我们希望完整的表达我们的想法和原则，不是东拼西凑的追随。</p>
<h4 id="怎样都能用">怎样都能用</h4>
<p>你想怎样引用一个 Library？</p>
<ul>
<li>直接下下来</li>
<li>npm install</li>
<li>CDN</li>
</ul>
<p>产品开发是什么环境？</p>
<ul>
<li>啥都没，裸的，怎样开发怎样上线</li>
<li>有些简单的 bundle 和 compress</li>
<li>模块化管理，不过是古老的 AMD</li>
<li>主流代表，WebPack + Babel</li>
</ul>
<p>我们不关心你从哪里来，要到哪里去，我们只想给你提供一个舒适的港湾。这个广告词是不是恶心到大家了...... <strong>怎样都能用</strong> 确实是我们的目标，提供 CDN、支持 AMD 和 Global Object、npm publish 也都是很简单的事情，更难抉择的是 “你们怎么解决兼容性问题”。</p>
<h4 id="通过方法操作组件数据解决兼容性">通过方法操作组件数据，解决兼容性</h4>
<p>在 San 组件中，对数据的变更需要通过 <code>set</code> 或 <code>splice</code> 等方法。<a href="https://ecomfe.github.io/san/tutorial/data-method/" target="_blank" rel="noopener">数据操作</a>文档详细描述了这一点。这意味着：</p>
<ul>
<li>用最简单的形式，解决兼容性问题</li>
<li>San 的开发体验不可能做的比 Vue 更好</li>
<li>数据操作的过程可控。实际上，从 3.1.0 开始，数据变更在内部是 Immutable 的</li>
<li>change tracking好做了。我们并不认为 v-dom 是万金油，并且 San 是面向 Web 设计的，我们并没期望它跨平台。所以少掉 v-dom 这一层是一件好事</li>
</ul>
<p>我们也考虑过让使用者自己通过 Immutable 的方式操作数据，然后再怼回来，但这样对使用者的成本会变高，而且使用者未必会理解为啥要这样干，所以还是封起来了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.data.set(<span class="string">'user'</span>, userName);</span><br><span class="line"></span><br><span class="line"><span class="comment">// vs</span></span><br><span class="line"></span><br><span class="line">setData(<span class="built_in">Object</span>.assign(&#123;&#125;, data, &#123;<span class="attr">user</span>: userName&#125;));</span><br></pre></td></tr></table></figure>
<p>但是，把数据封起来意味着获取数据成本也变高了，特别是想一次获取多个数据的时候。所以我们把获取数据的 get 方法实现为，无参的时候返回整个数据对象，如果你用 ESNext 开发可以方便的使用解构。但是，操作数据还是要通过 <code>set</code> 或 <code>splice</code> 等方法的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;name, email&#125; = <span class="keyword">this</span>.data.get();</span><br></pre></td></tr></table></figure>
<h4 id="组件形态">组件形态</h4>
<p>虽然我们很欣赏 Vue，但是我们并不认同 component = data。在 Vue 中，数据直接置于组件下，methods被规约。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#example-3'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// methods被规约</span></span><br><span class="line">    methods: &#123;</span><br><span class="line">        reverseMessage: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.message = <span class="keyword">this</span>.message.split(<span class="string">''</span>).reverse().join(<span class="string">''</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>我们更习惯 method 直接置于组件下，数据被规约（其实已经被封装）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">san.defineComponent(&#123;</span><br><span class="line">    template: <span class="string">'&lt;div&gt;...&lt;button type="button" on-click="submit"&gt;submit&lt;/button&gt;&lt;/div&gt;'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// method 直接置于组件下</span></span><br><span class="line">    submit: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> title = <span class="keyword">this</span>.data.get(<span class="string">'title'</span>);</span><br><span class="line">        <span class="keyword">if</span> (!title) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        sendData(&#123;<span class="attr">title</span>: title&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>不过，这是一个理念问题，并没有谁好谁坏。</p>
<h4 id="组件声明">组件声明</h4>
<p>我们认为组件应该是一个 class（不要较真，就是 function）。在 ESNext 中，我们可以利用 extends 构造组件之间的继承关系。这样看起来更自然。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Component&#125; <span class="keyword">from</span> <span class="string">'san'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> template = <span class="string">'&lt;p&gt;Hello &#123;&#123;name&#125;&#125;!&lt;/p&gt;'</span>;</span><br><span class="line"></span><br><span class="line">    initData() &#123; </span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">name</span>: <span class="string">'San'</span>&#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ESNext 是无法声明 prototype property 的。所以，对于 template / filters / components 等属性，San 提供了 static property 的支持。</p>
<p>对于不愿意使用 ESNext 的产品，我们提供 defineComponent 方法，能够方便快捷的声明组件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> HelloComponent = san.defineComponent(&#123;</span><br><span class="line">    template: <span class="string">'&lt;p&gt;Hello &#123;&#123;name&#125;&#125;!&lt;/p&gt;'</span>,</span><br><span class="line"></span><br><span class="line">    initData: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">name</span>: <span class="string">'San'</span>&#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="组件反解">组件反解</h4>
<p>我们希望 San 能够从带有特定标记的 HTML 中，解析出组件结构来，通过组件来响应和管理后续的用户交互等操作，我们管这事叫做 <a href="https://ecomfe.github.io/san/tutorial/reverse/" target="_blank" rel="noopener">组件反解</a>。 （什么，你说叫反序列化？也行啊，开心就好）</p>
<ul>
<li>后端直出 HTML 在首屏时间是有优势的，特别是内容为主的应用</li>
<li>使用 NodeJS 提供在线 Web 服务不一定在任何地方都行得通，至少在我厂很多地方是行不通的。NodeJS 也不是万金油</li>
</ul>
<p>所以我们先制定了 <code>特定标记</code> 的协议，基于此实现了组件反解的功能。后来实现的 NodeJS 服务端渲染功能也是基于 <strong>组件反解</strong> 的，输出符合协议的 HTML。</p>
<p>另外，对于服务端渲染，恐怕大家最关心的是性能。<a href="https://ecomfe.github.io/san/tutorial/ssr/" target="_blank" rel="noopener">San的服务端渲染</a>经过测试，比号称最快的 JS 模板引擎 <a href="http://aui.github.io/art-template/" target="_blank" rel="noopener">art-template</a> 慢30%-40%，慢的部分主要是因为要额外生成前端可被辨识和反解的标记。已经是 string-based 模板引擎的性能级别了。</p>
<h4 id="k">10k</h4>
<p>在各种 Library 不在乎体积的今天，大体积的副作用其实并不少，除了网络传输以外，<a href="http://www.infoq.com/cn/articles/javascript-start-up-performance" target="_blank" rel="noopener">移动端 JS Parse 的时间其实并不可忽视</a>。所以我设定了个目标，不包含开发调试支持的版本，GZip 后体积不能超过 10k。为什么是 10k 呢，拍脑袋而已，可能是 mission impossible，不去试试谁知道呢？</p>
<p>最开始的简陋版本确实不太大，但是由于增加兼容性的处理、增加新 feature、代码拆分，让我们不止一次体积超过 10k。每次回头去找代码有什么可以优化的地方，到后来可优化的地方越来越少，也差点被当成强迫症患者送去医院。不过到最后竟然真的做到了。</p>
<p>其实这也不是什么很有技术含量的事情，为此我们直接手写 ES5 代码而不是 ESNext + Babel，在很多人看来还是挺 low B 的。具体是不是 10k 也没什么意义，只是态度而已。我们希望 San 的使用者不会受到体积的困扰，我们也希望体积强迫症患者能有更多的选择。</p>
<h4 id="性能">性能</h4>
<p>在我们刚开始做 San 的时候，很多流行的方案还是有一些性能问题的（比如Angular的更新、Vue的初始渲染等等）。但是世界变化那么快，1年多过去了，现在大家的性能其实都还不错，谁比谁笨呢？San 的性能也还不错，但也没有一骑绝尘，大家都差不多，不同场景也各有优势。感兴趣的同学自己测吧。</p>
<h3 id="还有些什么">还有些什么</h3>
<h4 id="应用状态管理">应用状态管理</h4>
<p>这年头，一个方案里没有应用状态管理，别人看你都像残废。所以我们提供了 <a href="https://github.com/ecomfe/san-store" target="_blank" rel="noopener">san-store</a>。它还是有自己的特点的：</p>
<ul>
<li>名字有特点。在大家都叫 nnnx 的时候，我们希望传达 store 做为全局唯一的应用状态源的观念，就叫 store了</li>
<li>抽象有不同。我们还是希望尽量好用好理解。redux 的模式我们嫌烦琐，为了假装有节操又不能抄 vuex，所以我们提供了更简单的抽象，只有Action。</li>
<li>应用状态数据的操作，我们通过 <a href="https://github.com/ecomfe/san-update" target="_blank" rel="noopener">san-update</a> 完成</li>
</ul>
<h4 id="router">router</h4>
<p>这也是一个没有就残废的东西，但想想也没啥好说的，有需要的自己看吧。<a href="https://github.com/ecomfe/san-router" target="_blank" rel="noopener">san-router</a></p>
<h4 id="组件库">组件库</h4>
<p>组件库是减少实际业务开发工作量、解放生产力的根本。</p>
<ul>
<li><a href="https://material.io/guidelines/" target="_blank" rel="noopener">Material Design</a> 是认知度比较高的一套视觉体系，我们基于它开发了一个<a href="https://ecomfe.github.io/san-mui/" target="_blank" rel="noopener">MUI组件库</a>。</li>
<li><a href="https://weui.io/" target="_blank" rel="noopener">WeUI</a> 是微信输出的、Mobile 友好的一套视觉体系，但是目前没有 San 的实现，欢迎感兴趣的同学来一套，质量好的话我们会在官网推荐喔。</li>
<li><a href="https://ant.design/" target="_blank" rel="noopener">AntDesign</a> 是蚂蚁输出的、适合各种管理系统的一套视觉体系，但是目前没有 San 的实现，也欢迎感兴趣的同学来一套，质量好的话我们会在官网推荐喔。</li>
<li>如果你的应用拥有自己的视觉体系，自己开发组件库是免不了的</li>
</ul>
<p>曾经有人和我说，你们应该推自己的组件库啊，其实大家做应用的时候并不 care 是什么，只要好看好用就行。可是我厂是没有自己的视觉交互体系的，我能怎么办，我也很绝望啊。</p>
<h4 id="devtool">DevTool</h4>
<p>DevTool 在写这篇广告的时候还没有 ready，快了，一周以内吧。请关注 <a href="https://ecomfe.github.io/san/" target="_blank" rel="noopener">San WebSite</a></p>
<h3 id="最后">最后</h3>
<p>到这里，应该不难看出，San 有一些 <strong>传统</strong> 的地方：</p>
<ul>
<li>还在兼容 Old IE</li>
<li>还在考虑不使用 babel transform 的业务开发场景</li>
<li>还在为体积纠结</li>
<li>还想保持后端无关，而不是推 NodeJS</li>
</ul>
<p>如果拿车来比喻，我们想造的是一台陆巡。相比轿车甚至多数SUV，它没有那么好开，看不到很多 2.0T 的车尾灯；相比牧马人和 benz G，他越野能力和通过性也没那么强。但是它很可靠，能稳稳当当、舒适地带你到任何想去的地方。</p>
<p>既然你都能有耐心看到这，不介意关注下？ ^_^</p>
<iframe src="https://ghbtns.com/github-btn.html?user=ecomfe&amp;repo=san&amp;type=star&amp;count=true" frameborder="0" scrolling="0" width="170px" height="20px">
</iframe>

    
</article>

<div class="article-license">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="知识共享许可协议" src="/img/cc-by.png" width="80" height="15"></a>
</div>
<nav class="article-pagination">
    
    <a href="/blog/echarts-3-7-0/" class="article-prev">前一篇: ECharts v3.7 发布：富文本标签、可滚动图例</a>
    
    
    <a href="/blog/building-realistic-map-with-echarts-gl/" class="article-next">后一篇: 在 ECharts GL 中绘制三维地图</a>
    
</nav>

<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"32"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

<div class="ds-thread" data-thread-key="blog/san-a-traditional-mvvm-component-framework/" data-title="San - 一个传统的MVVM组件框架" data-url="http://efe.baidu.com/blog/san-a-traditional-mvvm-component-framework/"></div>
<script>
var duoshuoQuery = {short_name:"baidu-efe"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';
    ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>




<footer>
    <p class="copy">&copy;2018 Baidu EFE | Powered By <a href="http://hexo.io/" target="_blank" title="Hexo">Hexo</a></p>
</footer>

<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F8581b5de0049c5e3009931686fc45d7a' type='text/javascript'%3E%3C/script%3E"));
</script>

</body>
</html>


