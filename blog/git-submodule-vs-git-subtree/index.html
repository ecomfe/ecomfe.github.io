<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width,
                   height=device-height,
                   initial-scale=1.0,
                   maximum-scale=1.0,
                   user-scalable=no"
    />
    <meta name="author"
          content="ecomfe">
    
    
    <title>git submoudle vs git subtree | EFE Tech</title>
    

    <link rel="stylesheet" href="/css/page.css">
    <link rel="stylesheet" href="/css/code.css">
    <link rel="stylesheet" href="/css/font-awesome.css">
</head>
<body>

<aside>
    <a class="home" href="/" title="EFE Home"><abbr title="EFE">EFE</abbr></a>
    <nav>
        <a href="https://github.com/ecomfe/spec" target="_blank">SPECS</a>
        <a href="/projects/">PROJECTS</a>
        <!--a href="/about.html">ABOUT</a-->
    </nav>
    <ul class="product-overview">
        <li><a target="_blank" href="https://ecomfe.github.io/san/"> <span class="product-overview-title">SAN</span> <span class="product-overview-desc">- MVVM 组件框架</span></a></li>
        <li><a target="_blank" href="http://fecs.baidu.com/"> <span class="product-overview-title">FECS</span> <span class="product-overview-desc">- 前端代码风格检查套件</span></a></li>
        <li><a target="_blank" href="http://echarts.baidu.com/"> <span class="product-overview-title">ECharts</span> <span class="product-overview-desc">- 数据可视化图表库</span></a></li>
        <li><a target="_blank" href="https://github.com/ecomfe/esl"><span class="product-overview-title">ESL</span> <span class="product-overview-desc"> - AMD Loader</span></a></li>
        <li><a target="_blank" href="http://ecomfe.github.io/edp/"><span class="product-overview-title">EDP</span> <span class="product-overview-desc"> - 前端开发平台</span></a></li>
        <li><a target="_blank" href="http://ecomfe.github.io/est/"><span class="product-overview-title">EST</span> <span class="product-overview-desc"> - 基于 Less 的样式工具库</span></a></li>
        <li><a target="_blank" href="http://ecomfe.github.io/saber/"><span class="product-overview-title">Saber</span> <span class="product-overview-desc"> - 移动 SPA 项目解决方案</span></a></li>
        <li><a target="_blank" href="http://ecomfe.github.io/saber/"><span class="product-overview-title">Rebas</span> <span class="product-overview-desc"> - 基于 NodeJS 的同构解决方案</span></a></li>
        <li><a target="_blank" href="https://github.com/ecomfe/rider"><span class="product-overview-title">Rider</span> <span class="product-overview-desc"> - 移动样式工具库</span></a></li>
        <li><a target="_blank" href="https://github.com/ecomfe/er"><span class="product-overview-title">ER</span> <span class="product-overview-desc"> - SPA 应用框架</span></a></li>
        <li><a target="_blank" href="https://github.com/ecomfe/esui"><span class="product-overview-title">ESUI</span> <span class="product-overview-desc"> - UI 组件库</a></span></li>
        <li><a target="_blank" href="http://ecomfe.github.io/etpl/"><span class="product-overview-title">ETpl</span> <span class="product-overview-desc"> - 灵活、高性能的模板引擎</span></a></li>
        <li><a target="_blank" href="https://github.com/BE-FE/iSlider"><span class="product-overview-title">iSlider</span> <span class="product-overview-desc"> - 轻量、高性能的移动滑动方案</span></a></li>
        <li><a target="_blank" href="http://tushuo.baidu.com/"><span class="product-overview-title">图说</span> <span class="product-overview-desc"> - 可视化数据分享平台</span></a></li>
        <li><a target="_blank" href="http://ecomfe.github.io/fontmin"><span class="product-overview-title">Fontmin</span> <span class="product-overview-desc"> - 首个纯 JS 字体子集化方案</span></a></li>
    </ul>
    <p class="efe-desc">百度EFE（Excellent FrontEnd）技术体系，前身是ECOM前端团队，后经过技术的发展，逐渐形成一套完善的前端技术体系。<br><br>EFE技术体系现由多个遵循该技术体系的前端团队所组成。E(Excellent)代表我们追求卓越的技术态度。</p>

    
    <dl class="tags">
        <dt>Tags</dt>
        
            <dd><a href="/tags/JavaScript/">JavaScript</a> <small>(30)</small></dd>
        
            <dd><a href="/tags/ECharts/">ECharts</a> <small>(20)</small></dd>
        
            <dd><a href="/tags/数据可视化/">数据可视化</a> <small>(17)</small></dd>
        
            <dd><a href="/tags/模块化/">模块化</a> <small>(9)</small></dd>
        
            <dd><a href="/tags/CSS/">CSS</a> <small>(8)</small></dd>
        
            <dd><a href="/tags/教程/">教程</a> <small>(7)</small></dd>
        
            <dd><a href="/tags/AMD/">AMD</a> <small>(6)</small></dd>
        
            <dd><a href="/tags/新版本/">新版本</a> <small>(6)</small></dd>
        
            <dd><a href="/tags/ESNext/">ESNext</a> <small>(6)</small></dd>
        
            <dd><a href="/tags/Lint/">Lint</a> <small>(4)</small></dd>
        
            <dd><a href="/tags/MVVM/">MVVM</a> <small>(4)</small></dd>
        
            <dd><a href="/tags/Mobile/">Mobile</a> <small>(4)</small></dd>
        
            <dd><a href="/tags/font/">font</a> <small>(4)</small></dd>
        
            <dd><a href="/tags/San/">San</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/ES6/">ES6</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/HTML/">HTML</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/优化/">优化</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/NodeJS/">NodeJS</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/React-Native/">React Native</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/Hint/">Hint</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/图片/">图片</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/tool/">tool</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/promise/">promise</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/IoC/">IoC</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/用户体验/">用户体验</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/地图/">地图</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/ESL/">ESL</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/中文字体/">中文字体</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/GL/">GL</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/Less/">Less</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/重构/">重构</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/practice/">practice</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/fixed/">fixed</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/设计/">设计</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/mixin/">mixin</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/React/">React</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/JS-Engine/">JS Engine</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/Objective-C/">Objective C</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/DI/">DI</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/Check/">Check</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/依赖注入/">依赖注入</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/OO/">OO</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Isomorphic/">Isomorphic</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/可视分析/">可视分析</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/高阶组合/">高阶组合</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Layout/">Layout</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/硬件加速/">硬件加速</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Hardware-Accelerated/">Hardware Accelerated</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/subtree/">subtree</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/submoudle/">submoudle</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/git/">git</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Saucelabs/">Saucelabs</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/1px/">1px</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/tesing/">tesing</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Travis-CI/">Travis CI</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/HTTP/">HTTP</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/REST/">REST</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/float/">float</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/ETpl/">ETpl</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/模板引擎/">模板引擎</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/弹性滚动/">弹性滚动</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/MVC/">MVC</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/beautify/">beautify</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/fix/">fix</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/format/">format</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/check/">check</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/MVP/">MVP</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/构建/">构建</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/3D/">3D</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/ECharts-X/">ECharts-X</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Ionic/">Ionic</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/SPA/">SPA</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/水球图/">水球图</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/直方图/">直方图</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Number/">Number</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/IEEE-754/">IEEE_754</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/iOS/">iOS</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/字体/">字体</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/图标/">图标</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/SVG/">SVG</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/sticky/">sticky</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/响应式/">响应式</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/预处理器/">预处理器</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/工具疲劳/">工具疲劳</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Sass/">Sass</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Stylus/">Stylus</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/文本截断/">文本截断</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/ellipsis/">ellipsis</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/text-overflow/">text-overflow</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/algorithm/">algorithm</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/VitualDOM/">VitualDOM</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Preact/">Preact</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/扩展性/">扩展性</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/高阶函数/">高阶函数</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/forEach/">forEach</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/baidu网盘/">baidu网盘</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Android/">Android</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/venn/">venn</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/VIM/">VIM</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Completion/">Completion</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/color/">color</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/前端设计感/">前端设计感</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/windows/">windows</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/XHR/">XHR</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/baidubce/">baidubce</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Coveralls/">Coveralls</a> <small>(1)</small></dd>
        
    </dl>


        <dl class="links">
        <dt>Links</dt>
        <dd><a target="_blank" href="http://fex.baidu.com/">Baidu FEX</a></dd>
        <dd><a target="_blank" href="http://eux.baidu.com/">Baidu EUX</a></dd>
        <dd><a target="_blank" href="http://ued.taobao.org/blog/">Taobao UED</a></dd>
        <dd><a target="_blank" href="http://www.alloyteam.com/">Tencent AlloyTeam</a></dd>
        <dd><a target="_blank" href="http://isux.tencent.com/">Tencent ISUX</a></dd>
        <dd><a target="_blank" href="http://ued.ctrip.com/blog/?cat=11">CTrip UED</a></dd>
        <dd><a target="_blank" href="http://www.75team.com/">75Team</a></dd>
    </ul>

</aside>

<article>
    
        <h1>git submoudle vs git subtree</h1>
    

    <div class="article-meta">
        <span class="article-author"><i class="fa fa-pencil"></i>
    
        <a target="_blank" href="https://github.com/leeight" title="leeight">leeight</a>
    
</span>

        <time datetime="2015-04-13T16:00:00.000Z" itemprop="datePublished"><i class="fa fa-clock-o"></i> 2015-04-14</time>

        
    
    <span class="article-tags"><i class="fa fa-tag"></i> <a href="/tags/git/">git</a>, <a href="/tags/submoudle/">submoudle</a>, <a href="/tags/subtree/">subtree</a></span>


    </div>

    
        <p>先说结论：在项目模块拆分的时候，先考虑使用了 git submoudle 的方案，因为遇到一些问题，又研究了一下 git subtree 的方案，最后发现 git subtree 的成本更高，最后还是选择了 git submodule 的方案</p>
<p>git submodule 最初作为项目模块拆分时候的方案，在使用的过程中发现了几个问题：</p>
<ol style="list-style-type: decimal">
<li>同步代码比较麻烦</li>
<li>冲突解决起来不方便（因人而异）</li>
<li>有时候不确定是否应该PUSH本次的改动（主要是 new commits 的状态）</li>
<li>代码的重复性很高，占用硬盘（各个模块依赖的 common 和 dep 的体积很大，重复了很多次）</li>
</ol>
<p>查询了一些相关资料之后，看到有同学提到使用 git subtree 的一种解决方案，因此在bce-console/console上面弄了一个subtree的分支尝试了一下。</p>
<p>首先，我们还是把 bce-console/console 作为整个项目的集合来进行管理。</p>
<a id="more"></a>
<p>第一步：检出代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone http://git.server/bce-console/console.git all-bce-console</span><br><span class="line">git checkout subtree</span><br></pre></td></tr></table></figure>
<p>此时我们发现，这个分支上面基本上什么都没有，src目录是空的</p>
<p>第二步：添加一些 remote</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git remote add x-dep http://git.server/bce-console/dep.git</span><br><span class="line">git remote add x-mockup http://git.server/bce-console/mockup.git</span><br><span class="line">git remote add x-common http://git.server/bce-console/common.git</span><br></pre></td></tr></table></figure>
<p>后续我们就可以使用 x-dep 来代替 http://git.server/bce-console/dep.git 这个仓库了，就跟我们平时使用 origin 代替 http://git.server/bce-console/console.git 一样。</p>
<p>第三步：使用subtree添加目录</p>
<p>添加目录之前我们先把 x-dep, x-mockup, x-common 代码下载下来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git fetch x-common</span><br><span class="line">git fetch x-dep</span><br><span class="line">git fetch x-mockup</span><br></pre></td></tr></table></figure>
<p>现在就可以调用 subtree 命令了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git subtree add --prefix=dep x-dep master --squash</span><br><span class="line">git subtree add --prefix=mockup x-mockup master --squash</span><br><span class="line">git subtree add --prefix=src/common x-common master --squash</span><br></pre></td></tr></table></figure>
<p><code>--prefix</code> 就是我们要添加的那个目录，x-dep 就是前面 git remote 添加的那个地址，master 就是分支的名字</p>
<p>现在切换到 dep, mockup, src/common 目录去看看，应该发现已经有代码了吧</p>
<p>第四步：来是修改业务代码</p>
<p>假如我们要修改 bcc 模块的代码，可以参考类似前面的做法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git remote add x-bcc http://git.server/bce-console/bcc.git</span><br><span class="line">git fetch x-bcc</span><br><span class="line">git subtree add --prefix=src/bcc x-bcc master</span><br></pre></td></tr></table></figure>
<p>好了，到此为止，代码都有了，开始干活。</p>
<p>不过干活之前，先备个份呗</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin subtree</span><br></pre></td></tr></table></figure>
<p>第五步：提交代码</p>
<p>吭哧吭哧开始写代码，把 dep, mockup, src/common, src/bcc 都修改了，改完之后本地也commit了，开始要push了，但是应该提交到哪里呢？</p>
<p>其实不要想那么多，直接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git commit -a -m ‘some commit message&apos;</span><br><span class="line">git push origin subtree</span><br></pre></td></tr></table></figure>
<p>就把这些改动提交到了 bcc-console/console 的 subtree 分支。</p>
<p>但是这些改动并没有体现在 x-dep, x-common, x-mockup 的仓库，如果以后其他人 clone 了这些仓库，并没有看到我们改动，岂不是很麻烦，如果能想到这个问题，非常好，其实已经有解决方案了，就是使用 git subtree push。执行下面的命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git subtree push --prefix=src/bcc x-bcc subtree</span><br></pre></td></tr></table></figure>
<p>意思就是把最近的一些改动 push 到 x-bcc 这个仓库的 subtree 分支。</p>
<p>第六步：同步代码</p>
<p>既然前面提到了提交代码，就肯定会涉及到代码的同步，假如我直接修改了 x-mockup 仓库里面的数据，怎么同步过过来呢？其实方案跟上面的过程类似，首先需要把最新的代码拖下来，执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch x-mockup</span><br></pre></td></tr></table></figure>
<p>然后就是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git subtree pull --prefix=mockup x-mockup master --squash</span><br></pre></td></tr></table></figure>
<h3 id="关于-squash">关于 squash</h3>
<p>如果细心的同学可能注意到了，前面 git subtree add 和 git subtree pull 的时候都有一个 squash 参数，这个参数是干啥的呢？我也不好解释，只能举个例子来说明：</p>
<p>假如我们在 x-mockup 上面提交了 10 个commit，如果没有 squash 参数，那么 git subtree pull 的时候，这 10 个commit 都会体现在 bce-console/console 的 git history 里面。</p>
<p>但是一般情况下，我同步代码的时候，并不关心 commit A 和 commit B 之间提交了哪些东西，我只关心从 commit A 升级到 commit B，此时加上 squash 参数就可以在 git history 里面只体现一个 commit。例如：</p>
<p>实际上 bbabe74 到 a8f8105 之间有 2 个commit，这个从 x-mockup 的 git history 里面可以看出来</p>
<p>但是因为我实际上是比较关心 x-bcc 的提交历史的，因此执行 git subtree add 时候，并没有带着 squash 参数，所以 x-bcc 这个仓库的历史都可以体现在 bce-console/console 这个仓库里面。</p>
<h3 id="faq">FAQ</h3>
<ol style="list-style-type: decimal">
<li>为啥搞得这么复杂？</li>
</ol>
<p>我（个人）感觉并不是特别复杂，我们面对的问题是一个很常见的模块复用的问题。git 里面默认集成的 submodule 和 subtree 自然有它的原因，学习使用这些工具来解决我们的问题，是很常见的一种方式。</p>
<ol start="2" style="list-style-type: decimal">
<li>为什么不考虑使用 symlink 的方式呢？</li>
</ol>
<p>通过软链接也是可以解决问题的，但是有两个弊端：第一个是在 Windows 平台上支持的程度有限（如果有其它方式，望不吝赐教）；另外一个问题是，如果我需要同步代码的话，就必须切换到 软链接 所在的目录，而不是直接使用 git subtree pull 来完成操作，还有就是如果改动了 软链接 所在目录的代码，也必须切换过去才能 push。</p>
<ol start="3" style="list-style-type: decimal">
<li>如果我想使用另外一个分支的内容，肿么办？</li>
</ol>
<p>前面我添加 x-common 的时候，用的是 master 分支。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git subtree add --prefix=src/common x-common master --squash</span><br></pre></td></tr></table></figure>
<p>如果这个分支上面有些 BUG，成阳修改之后先 PUSH 到了 x-common 仓库的 develop 分支，我应该如何切换到 develop 分支呢？其实方式很简单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git fetch x-common</span><br><span class="line">git rm -r src/common</span><br><span class="line">git commit -a -m ‘Before switch src/common subtree branch&apos;</span><br><span class="line">git subtree add --prefix=src/common x-common develop --squash</span><br></pre></td></tr></table></figure>
<p>主要的原理就是先删除，再加上。另外还有一种方式就是 git subtree pull 另外一个分支的名字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git subtree pull --prefix=src/common x-common develop --squash</span><br></pre></td></tr></table></figure>
<h3 id="使用-git-subtree-的时候遇到几个问题">使用 git subtree 的时候遇到几个问题</h3>
<p>按照上面的开发流程，本地的项目实际上可以正常的运行的，但是使用了一段儿时间之后，发现用 git subtree 管理这些模块有一些明显的劣势：</p>
<ol style="list-style-type: decimal">
<li>切换分支并不太方便</li>
</ol>
<p>因为我们使用 Gitlab 的 Merge Request 的功能来 Review 代码，大部分功能基本上都是在分支上面进行开发的，如果想要把本地某个目录的代码切换到某个分支，就需要执行<code>git rm -rf</code>和<code>git subtree add</code>的操作，明显没有<code>git checkout branch</code>来的方便</p>
<ol start="2" style="list-style-type: decimal">
<li>代码提交的速度问题</li>
</ol>
<p>我没有详细研究过 git 的原理，不太清楚为什么 git subtree push 的速度如此，其实 <a href="http://stackoverflow.com/questions/16134975/reduce-increasing-time-to-push-a-subtree" target="_blank" rel="noopener">SO</a> 上面也有人问过类似的问题，最终随着 commit 的记录越来越多，已经到了无法忍受的底部了，有的同学每次 push 需要花费几分钟的时间（当然跟设备的配置也有一定的关系），很影响工作效率</p>
<ol start="3" style="list-style-type: decimal">
<li>冲突的解决不太方便</li>
</ol>
<p>具体不方便在什么地方我也记得不是很清楚了</p>
<p>这几个问题相比最初使用 git submodule 遇到的问题而言，感觉使用 git submodule 遇到的那几个问题根本不是什么大问题了</p>
<ol style="list-style-type: decimal">
<li>同步代码比较麻烦</li>
</ol>
<p>自己写个简单的脚本来同步</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env bash</span><br><span class="line"></span><br><span class="line">set -x</span><br><span class="line">git submodule update --remote</span><br><span class="line">git submodule -q foreach &apos;pwd; git checkout -q master; git pull -q&apos;</span><br></pre></td></tr></table></figure></p>
<ol start="2" style="list-style-type: decimal">
<li>冲突解决起来不方便（因人而异）</li>
</ol>
<p>发起 Merge Request 的同学自行解决冲突，Reviewer合并代码到 master 的时候如果有冲突就暂时不处理。这种机制保证了我们 master 分支的提交历史是很干净的，然后代码同步到 svn server 也很顺利。</p>
<ol start="3" style="list-style-type: decimal">
<li>有时候不确定是否应该PUSH本次的改动（主要是 new commits 的状态）</li>
</ol>
<p>new commits 就不要提交了</p>
<ol start="4" style="list-style-type: decimal">
<li>代码的重复性很高，占用硬盘（各个模块依赖的 common 和 dep 的体积很大，重复了很多次）</li>
</ol>
<p>调整了一下目录的结构，common 和 dep 从业务目录中提取出来，放到上一层目录，逻辑上还是存在的，比如请求 <code>/bcc/dep/xxx.js</code>的时候，让 <code>edp webserver</code>处理一下，从 <code>/dep/xxx.js</code>的位置读取文件，同样的对于<code>/bcc/common/yyy.js</code>也是同样的处理逻辑</p>

    
</article>

<div class="article-license">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="知识共享许可协议" src="/img/cc-by.png" width="80" height="15"></a>
</div>
<nav class="article-pagination">
    
    <a href="/blog/fontmin-getting-started/" class="article-prev">前一篇: Fontmin 快速指南</a>
    
    
    <a href="/blog/mobile-fixed-layout/" class="article-next">后一篇: Web移动端Fixed布局的解决方案</a>
    
</nav>

<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"32"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

<div class="ds-thread" data-thread-key="blog/git-submodule-vs-git-subtree/" data-title="git submoudle vs git subtree" data-url="http://efe.baidu.com/blog/git-submodule-vs-git-subtree/"></div>
<script>
var duoshuoQuery = {short_name:"baidu-efe"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';
    ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>




<footer>
    <p class="copy">&copy;2018 Baidu EFE | Powered By <a href="http://hexo.io/" target="_blank" title="Hexo">Hexo</a></p>
</footer>

<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F8581b5de0049c5e3009931686fc45d7a' type='text/javascript'%3E%3C/script%3E"));
</script>

</body>
</html>


