<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width,
                   height=device-height,
                   initial-scale=1.0,
                   maximum-scale=1.0,
                   user-scalable=no"
    />
    <meta name="author"
          content="ecomfe">
    
    
    <title>实战响应式图片 | EFE Tech</title>
    

    <link rel="stylesheet" href="/css/page.css">
    <link rel="stylesheet" href="/css/code.css">
    <link rel="stylesheet" href="/css/font-awesome.css">
</head>
<body>

<aside>
    <a class="home" href="/" title="EFE Home"><abbr title="EFE">EFE</abbr></a>
    <nav>
        <a href="https://github.com/ecomfe/spec" target="_blank">SPECS</a>
        <a href="/projects/">PROJECTS</a>
        <!--a href="/about.html">ABOUT</a-->
    </nav>
    <ul class="product-overview">
        <li><a target="_blank" href="https://ecomfe.github.io/san/"> <span class="product-overview-title">SAN</span> <span class="product-overview-desc">- MVVM 组件框架</span></a></li>
        <li><a target="_blank" href="http://fecs.baidu.com/"> <span class="product-overview-title">FECS</span> <span class="product-overview-desc">- 前端代码风格检查套件</span></a></li>
        <li><a target="_blank" href="http://echarts.baidu.com/"> <span class="product-overview-title">ECharts</span> <span class="product-overview-desc">- 数据可视化图表库</span></a></li>
        <li><a target="_blank" href="https://github.com/ecomfe/esl"><span class="product-overview-title">ESL</span> <span class="product-overview-desc"> - AMD Loader</span></a></li>
        <li><a target="_blank" href="http://ecomfe.github.io/edp/"><span class="product-overview-title">EDP</span> <span class="product-overview-desc"> - 前端开发平台</span></a></li>
        <li><a target="_blank" href="http://ecomfe.github.io/est/"><span class="product-overview-title">EST</span> <span class="product-overview-desc"> - 基于 Less 的样式工具库</span></a></li>
        <li><a target="_blank" href="http://ecomfe.github.io/saber/"><span class="product-overview-title">Saber</span> <span class="product-overview-desc"> - 移动 SPA 项目解决方案</span></a></li>
        <li><a target="_blank" href="http://ecomfe.github.io/saber/"><span class="product-overview-title">Rebas</span> <span class="product-overview-desc"> - 基于 NodeJS 的同构解决方案</span></a></li>
        <li><a target="_blank" href="https://github.com/ecomfe/rider"><span class="product-overview-title">Rider</span> <span class="product-overview-desc"> - 移动样式工具库</span></a></li>
        <li><a target="_blank" href="https://github.com/ecomfe/er"><span class="product-overview-title">ER</span> <span class="product-overview-desc"> - SPA 应用框架</span></a></li>
        <li><a target="_blank" href="https://github.com/ecomfe/esui"><span class="product-overview-title">ESUI</span> <span class="product-overview-desc"> - UI 组件库</a></span></li>
        <li><a target="_blank" href="http://ecomfe.github.io/etpl/"><span class="product-overview-title">ETpl</span> <span class="product-overview-desc"> - 灵活、高性能的模板引擎</span></a></li>
        <li><a target="_blank" href="https://github.com/BE-FE/iSlider"><span class="product-overview-title">iSlider</span> <span class="product-overview-desc"> - 轻量、高性能的移动滑动方案</span></a></li>
        <li><a target="_blank" href="http://tushuo.baidu.com/"><span class="product-overview-title">图说</span> <span class="product-overview-desc"> - 可视化数据分享平台</span></a></li>
        <li><a target="_blank" href="http://ecomfe.github.io/fontmin"><span class="product-overview-title">Fontmin</span> <span class="product-overview-desc"> - 首个纯 JS 字体子集化方案</span></a></li>
    </ul>
    <p class="efe-desc">百度EFE（Excellent FrontEnd）技术体系，前身是ECOM前端团队，后经过技术的发展，逐渐形成一套完善的前端技术体系。<br><br>EFE技术体系现由多个遵循该技术体系的前端团队所组成。E(Excellent)代表我们追求卓越的技术态度。</p>

    
    <dl class="tags">
        <dt>Tags</dt>
        
            <dd><a href="/tags/JavaScript/">JavaScript</a> <small>(30)</small></dd>
        
            <dd><a href="/tags/ECharts/">ECharts</a> <small>(20)</small></dd>
        
            <dd><a href="/tags/数据可视化/">数据可视化</a> <small>(17)</small></dd>
        
            <dd><a href="/tags/模块化/">模块化</a> <small>(9)</small></dd>
        
            <dd><a href="/tags/CSS/">CSS</a> <small>(8)</small></dd>
        
            <dd><a href="/tags/教程/">教程</a> <small>(7)</small></dd>
        
            <dd><a href="/tags/AMD/">AMD</a> <small>(6)</small></dd>
        
            <dd><a href="/tags/新版本/">新版本</a> <small>(6)</small></dd>
        
            <dd><a href="/tags/ESNext/">ESNext</a> <small>(6)</small></dd>
        
            <dd><a href="/tags/Lint/">Lint</a> <small>(4)</small></dd>
        
            <dd><a href="/tags/MVVM/">MVVM</a> <small>(4)</small></dd>
        
            <dd><a href="/tags/Mobile/">Mobile</a> <small>(4)</small></dd>
        
            <dd><a href="/tags/font/">font</a> <small>(4)</small></dd>
        
            <dd><a href="/tags/San/">San</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/ES6/">ES6</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/HTML/">HTML</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/优化/">优化</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/NodeJS/">NodeJS</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/React-Native/">React Native</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/Hint/">Hint</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/图片/">图片</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/tool/">tool</a> <small>(3)</small></dd>
        
            <dd><a href="/tags/promise/">promise</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/IoC/">IoC</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/用户体验/">用户体验</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/地图/">地图</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/ESL/">ESL</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/中文字体/">中文字体</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/GL/">GL</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/Less/">Less</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/重构/">重构</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/practice/">practice</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/fixed/">fixed</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/设计/">设计</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/mixin/">mixin</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/React/">React</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/JS-Engine/">JS Engine</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/Objective-C/">Objective C</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/DI/">DI</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/Check/">Check</a> <small>(2)</small></dd>
        
            <dd><a href="/tags/依赖注入/">依赖注入</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/OO/">OO</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Isomorphic/">Isomorphic</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/可视分析/">可视分析</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/高阶组合/">高阶组合</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Layout/">Layout</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/硬件加速/">硬件加速</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Hardware-Accelerated/">Hardware Accelerated</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/subtree/">subtree</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/submoudle/">submoudle</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/git/">git</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Saucelabs/">Saucelabs</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/1px/">1px</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/tesing/">tesing</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Travis-CI/">Travis CI</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/HTTP/">HTTP</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/REST/">REST</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/float/">float</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/ETpl/">ETpl</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/模板引擎/">模板引擎</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/弹性滚动/">弹性滚动</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/MVC/">MVC</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/beautify/">beautify</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/fix/">fix</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/format/">format</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/check/">check</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/MVP/">MVP</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/构建/">构建</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/3D/">3D</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/ECharts-X/">ECharts-X</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Ionic/">Ionic</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/SPA/">SPA</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/水球图/">水球图</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/直方图/">直方图</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Number/">Number</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/IEEE-754/">IEEE_754</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/iOS/">iOS</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/字体/">字体</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/图标/">图标</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/SVG/">SVG</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/sticky/">sticky</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/响应式/">响应式</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/预处理器/">预处理器</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/工具疲劳/">工具疲劳</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Sass/">Sass</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Stylus/">Stylus</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/文本截断/">文本截断</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/ellipsis/">ellipsis</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/text-overflow/">text-overflow</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/algorithm/">algorithm</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/VitualDOM/">VitualDOM</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Preact/">Preact</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/扩展性/">扩展性</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/高阶函数/">高阶函数</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/forEach/">forEach</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/baidu网盘/">baidu网盘</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Android/">Android</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/venn/">venn</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/VIM/">VIM</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Completion/">Completion</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/color/">color</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/前端设计感/">前端设计感</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/windows/">windows</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/XHR/">XHR</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/baidubce/">baidubce</a> <small>(1)</small></dd>
        
            <dd><a href="/tags/Coveralls/">Coveralls</a> <small>(1)</small></dd>
        
    </dl>


        <dl class="links">
        <dt>Links</dt>
        <dd><a target="_blank" href="http://fex.baidu.com/">Baidu FEX</a></dd>
        <dd><a target="_blank" href="http://eux.baidu.com/">Baidu EUX</a></dd>
        <dd><a target="_blank" href="http://ued.taobao.org/blog/">Taobao UED</a></dd>
        <dd><a target="_blank" href="http://www.alloyteam.com/">Tencent AlloyTeam</a></dd>
        <dd><a target="_blank" href="http://isux.tencent.com/">Tencent ISUX</a></dd>
        <dd><a target="_blank" href="http://ued.ctrip.com/blog/?cat=11">CTrip UED</a></dd>
        <dd><a target="_blank" href="http://www.75team.com/">75Team</a></dd>
    </ul>

</aside>

<article>
    
        <h1>实战响应式图片</h1>
    

    <div class="article-meta">
        <span class="article-author"><i class="fa fa-pencil"></i>
    
        <a target="_blank" href="http://weibo.com/u/1143654280" title="Justineo">Justineo</a>
    
</span>

        <time datetime="2014-11-27T16:00:00.000Z" itemprop="datePublished"><i class="fa fa-clock-o"></i> 2014-11-28</time>

        
    
    <span class="article-tags"><i class="fa fa-tag"></i> <a href="/tags/图片/">图片</a>, <a href="/tags/优化/">优化</a>, <a href="/tags/HTML/">HTML</a>, <a href="/tags/响应式/">响应式</a></span>


    </div>

    
        <p>原文：<a href="http://alistapart.com/article/responsive-images-in-practice" target="_blank" rel="noopener">Responsive Images in Practice</a></p>
<p>作者：<a href="http://alistapart.com/author/eportis" target="_blank" rel="noopener">Eric Portis</a></p>
<p>译者注：感谢<a href="http://weibo.com/u/1408056531" target="_blank" rel="noopener">米粽</a>、<a href="http://weibo.com/u/1765942617" target="_blank" rel="noopener">我佛山人</a>和<a href="http://weibo.com/u/2087024342" target="_blank" rel="noopener">otakustay</a>为译文提出的宝贵意见。</p>
<hr>
<blockquote>
<p>魔鬼因一切我们享受的东西而惩罚我们。</p>
<p>—阿尔伯特·爱因斯坦</p>
</blockquote>
<p><a href="http://httparchive.org/interesting.php#bytesperpage" target="_blank" rel="noopener">图片已经占了 Web 内容的 62%</a>，而且我们<a href="http://httparchive.org/trends.php?s=All&amp;minlabel=Nov+15+2010&amp;maxlabel=Oct+15+2014#bytesImg&amp;reqImg" target="_blank" rel="noopener">每天都在制造更多</a>。如果所有图片内容都能被好好加以利用那的确很赞。但是对小屏或低分辨率屏来说，<a href="http://timkadlec.com/2013/06/why-we-need-responsive-images/" target="_blank" rel="noopener">其中大部分数据都被浪费了</a>。</p>
<p>为什么？尽管 Web 设计初衷是让<a href="https://twitter.com/timberners_lee/status/228960085672599552" target="_blank" rel="noopener">所有人</a>能通过<a href="http://www.w3.org/Consortium/mission#principles" target="_blank" rel="noopener">任何途径</a>来访问，但直到最近，设备的碎片化才迫使业界全面转向了响应式设计。我们在进行响应式设计时，内容可以优雅且高效地流入任何设备。这说的是除了位图以外的所有内容。位图是固定分辨率的。而且他们的容器——敬爱的 <code>img</code> 和它那孤零零的 <code>src</code>——没有任何适配能力可言。</p>
<p>设计师们面临这样一个苏菲的选择<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>：让页面在有些情况下变模糊，还是在所有情况下变慢。大多数人倾向于后者，给所有人发送能适配最大、最高分辨率屏幕的图片。浪费啊。</p>
<p>但是！经过三年的辩论，我们有了一些新的标记来解决响应式图片这个问题：</p>
<a id="more"></a>
<ul>
<li><code>srcset</code></li>
<li><code>sizes</code></li>
<li><code>picture</code></li>
<li>还有我们的老朋友 <code>source</code>（借用自 <code>audio</code> 和 <code>video</code>）</li>
</ul>
<p>这些新元素和新属性让我们可以编写多个可替换的源图片，然后给每个客户端提供最合适的那个。它们已经进入了官方规范，而且 Chrome 38 已经在九月给出了第一个完整实现。再借助优雅的回退策略和一个用来兼容的 <a href="http://scottjehl.github.io/picturefill/" target="_blank" rel="noopener">polyfill</a><a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>，我们可以并且应当<em>立刻</em>实现响应式图片。那么，走起！</p>
<p>我们先找个已有的网页，然后来把它的图片做成响应式的。我们分三遍做，每遍轮番用上新标记的其中一组：</p>
<ol style="list-style-type: decimal">
<li>用 <code>srcset</code> 和 <code>sizes</code> 来保证图片高效地缩放。</li>
<li>通过 <code>picture</code> 和 <code>source media</code> 对图片进行艺术指导。</li>
<li>用 <code>picture</code> 和 <code>source type</code> 给图片提供可替换格式。</li>
</ol>
<p>在整个过程中，我们将第一时间看到新特性带给我们的巨大性能提升。</p>
<h2 id="现有技术">现有技术</h2>
<blockquote>
<p>我想我不那么在意我老了，相比我又胖又老的话。</p>
<p>—<a href="http://thinkexist.com/quotation/i_guess_i_don-t_so_much_mind_being_old-as_i_mind/200747.html" target="_blank" rel="noopener">本杰明·富兰克林</a>（还是<a href="http://www.tejvan.co.uk/funny/funny_quotes_old_age/view/index.html" target="_blank" rel="noopener">彼得·加布里埃尔</a>来着？）</p>
</blockquote>
<p>我们把主角定为<a href="http://alistapart.com/d/407/demo/status-quo.html" target="_blank" rel="noopener">一个关于疯狂拼布的小网页</a><a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a>。这是一个简单的响应式页面。这个页面除了主要的内容——巨大的（拼布！）图片——以外没太多别的东西了。我们想既展示每块拼布的整体设计又展示尽可能复杂的细节。那么，我们给每块拼布呈现两幅图片：</p>
<ol style="list-style-type: decimal">
<li>整块拼布，和段落同宽；</li>
<li>一幅充满 100% 视口宽度的细节图。</li>
</ol>
<p>在<em>没有</em>新标记的时候我们是怎样编写图片代码以及设定它们的尺寸的？</p>
<p>首先：整块拼布。要保证图片总是能清晰显示，我们需要知道它们在布局中可能的最大尺寸。下面是相关的 CSS 代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1.25em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">figure</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">1em</span>;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">33em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">img</span> &#123; </span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以用 <code>figure</code> 的 <code>max-width</code> 减去其 <code>padding</code>，然后将 em 单位转换为像素，计算出 <code>img</code> 可能的最大显示宽度：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  100% &lt;img&gt; width</span><br><span class="line">x ( 33em &lt;figure&gt; max-width</span><br><span class="line">   - 2em &lt;figure&gt; padding )</span><br><span class="line">x 1.25em &lt;body&gt; font-size</span><br><span class="line">x 16px default font-size</span><br><span class="line">= 620px</span><br></pre></td></tr></table></figure>
<p>或者我们可以作个弊，把窗口调得足够大，然后偷瞄一眼开发工具：</p>
<div class="figure">
<img src="img/box-model.png" alt="Chrome 的开发工具显示元素宽度为 620px。"><p class="caption">Chrome 的开发工具显示元素宽度为 620px。</p>
</div>
<p>（我更倾向于这第二种方法。）</p>
<p>无论用哪种方法，我们最终都得到了整块拼布的 <code>img</code> 最大显示宽度为 620px。我们将以两倍大小渲染我们的源图片来适应双倍屏：1240 像素宽。</p>
<p>但是怎么处理我们的细节图片呢？它们要放大充满整个视口的宽度，而视口尺寸没有固定的上限。那我们就选<a href="http://en.wikipedia.org/wiki/1080p" target="_blank" rel="noopener">一个大大的、感觉标标准准的尺寸</a>来渲染，比如说最大 1920 像素宽，就它了。</p>
<p>当我们按这些尺寸渲染图片时，<a href="http://alistapart.com/d/407/demo/status-quo.html" target="_blank" rel="noopener">使用既有方式实现的这个网页</a>重达 3.5MB。其中除了 5.7kB 以外全是图片。不用想也知道，其中很多的图片数据在发送到小屏、低分辨率屏设备时将成为无谓的开销。但有多少呢？让我们开工吧。</p>
<h2 id="第一遍用-srcset-和-sizes-缩放图片">第一遍：用 <code>srcset</code> 和 <code>sizes</code> 缩放图片</h2>
<blockquote>
<p>Teatherball with a tennis ball for his shoelaces</p>
<p>Naturally adapt to have more than two faces</p>
<p>—<a href="http://rapgenius.com/Kool-ad-dum-diary-lyrics#note-2535201" target="_blank" rel="noopener">Kool AD, Dum Diary</a><a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a></p>
</blockquote>
<p>我们要解决的第一个问题：调整图片使其可以在不同的视口宽度和屏幕分辨率下高效地缩放。我们要提供<em>多个分辨率</em>的图片，这样就可以有选择性地给巨大的或是高分辨率屏幕发送巨大的源图片，同时把小一些的内容发给其他人。怎么做到呢？用 <code>srcset</code>。</p>
<p>下面是我们的整屏宽细节图之一：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">"quilt_2-detail.jpg"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">alt</span>=<span class="string">"Detail of the above quilt, highlighting the embroidery and exotic stitchwork."</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>quilt_2-detail.jpg</code> 宽度为 1920 像素。再为它附带渲染两个小一点的版本，像这样写：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">    <span class="attr">srcset</span>=<span class="string">"quilt_2/detail/large.jpg  1920w, </span></span></span><br><span class="line"><span class="tag"><span class="string">            quilt_2/detail/medium.jpg  960w,</span></span></span><br><span class="line"><span class="tag"><span class="string">            quilt_2/detail/small.jpg   480w"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">"quilt_2/detail/medium.jpg"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">alt</span>=<span class="string">"Detail of the above quilt, highlighting the embroidery and exotic stitchwork."</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>首先需要注意这个 <code>img</code> 仍然有一个 <code>src</code>，用来在不支持新语法的浏览器中进行加载。</p>
<p>对更强大一些的客户端，我们加了一些新东西：一个 <code>srcset</code> 属性，它包含一个用逗号分隔的资源 URL 列表。在每个 URL 后面我们加了一个“宽度描述符”，来指定每个图片的像素宽度。你的图片是 1024 x 768 的？那就在 <code>srcset</code> 中对应的 URL 最后加一个 <code>1024w</code>。支持 <code>srcset</code> 的浏览器用这些像素宽度以及其它对当前浏览环境的一切感知来从这个集合种选择一个源图片进行加载。</p>
<p>怎么选择呢？这是我最爱 <code>srcset</code> 的一点了：不知道！我们<em>无从</em>知晓。选择逻辑是故意没有指定的。</p>
<p>这第一个解决响应式图片问题的方案试图给作者<em>更多</em>的控制权。这样<em>我们</em>就掌管了全局，构建覆盖所有情况的媒体查询（media query）——为每一种可能的屏幕大小及分辨率的组合制定应急计划，分别给出定制的源图片。</p>
<p><code>srcset</code> 解放了我们。合适粒度的控制在我们需要时（等下会说）仍然可用，但是大多数情况下我们最好还是把关键问题移交给浏览器来做决定。浏览器对一个用户的屏幕、视口、网络连接和偏好设置都非常了解。通过出让控制权——描述图片而非为无数个目标指定特定的源图片——就能让浏览器充分利用它已知的那些信息。我们则从少得多的代码中获得了更好的功能（还是对未来友好的！）。</p>
<p>然而，这里有一个坑：选择适当的源图片需要知道图片的布局尺寸。但是我们无法让浏览器等到页面的 HTML、CSS 和 JavaScript 全部加载且解析完毕以后再进行选择。所以我们得用另一个新属性来给浏览器提供一个预估的图片显示宽度：<code>sizes</code>。</p>
<p>我是如何把这个麻烦的真相隐藏到现在的？原因是我们示例页中的细节图是个特例。它们占据整个视口的宽度——<code>100vw</code>——恰好是 <code>sizes</code> 的默认值。但是我们的整块拼布图片，却要匹配段落宽度，并且往往要窄得多。我们理应用 <code>sizes</code> 来告诉浏览器它们究竟会有多宽。</p>
<p><code>sizes</code> 属性接受 <a href="http://www.w3.org/TR/css3-values/#lengths" target="_blank" rel="noopener">CSS 长度值</a>。所以：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sizes="100px"</span><br></pre></td></tr></table></figure>
<p>告诉浏览器：这张图片将以 <code>100px</code> 的固定宽度显示。轻松！</p>
<p>我们的例子更复杂一些。尽管拼布的 <code>img</code> 简单地用规则 <code>width: 100%</code> 设置了样式，但包含它们的 <code>figure</code> 元素有一个 <code>33em</code> 的 <code>max-width</code>。</p>
<p>幸运的是，<code>sizes</code> 可以让我们做两件事：</p>
<ol style="list-style-type: decimal">
<li>用一个以逗号分隔的列表提供多个长度；</li>
<li>为长度附加媒体条件。</li>
</ol>
<p>像这样：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sizes="(min-width: 33em) 33em, 100vw"</span><br></pre></td></tr></table></figure>
<p>这是在说：视口宽超过 <code>33em</code> 吗？那这张图将会是 <code>33em</code> 宽。否则它会是 <code>100vw</code> 宽。</p>
<p>这和我们需要的很接近了，但还是不够。em 单位的相对性让我们的例子变得有些微妙。我们页面的 body 有一个 <code>1.25em</code> 的 <code>font-size</code>，所以我们的 <code>figure</code> 元素的 CSS 上下文中，“1em”将会是 1.25 x 浏览器默认字号。但在媒体条件（也就是在 <code>sizes</code>）中，一个 em 永远等于默认字号。因此还要乘以 1.25 后得到：1.25 x 33 = 41.25。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sizes="(min-width: 41.25em) 41.25em,</span><br><span class="line">       100vw"</span><br></pre></td></tr></table></figure>
<p>这就比较好地得到了拼布的宽度，坦白说，也已经足够好了。对于 <code>sizes</code> 来说这已经是一个绝对可接受的对 <code>img</code> 布局宽度的粗略估算；而且用少许的精确度换来可读性及可维护性上的大幅提升，也往往是正确的选择。话虽如此，还是让我们继续，把图片两边的内边距的 em 数考虑进去，使我们的示例更准确：2 边 x 1.25 媒体条件 em 值 = 需要考虑的 2.5em 内边距。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">srcset</span>=<span class="string">"quilt_3/large.jpg  1240w, </span></span></span><br><span class="line"><span class="tag"><span class="string">            quilt_3/medium.jpg  620w,</span></span></span><br><span class="line"><span class="tag"><span class="string">            quilt_3/small.jpg   310w"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">sizes</span>=<span class="string">"(min-width: 41.25em) 38.75em,</span></span></span><br><span class="line"><span class="tag"><span class="string">           calc(100vw - 2.5em)"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">"quilt_3/medium.jpg"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">alt</span>=<span class="string">"A crazy quilt whose irregular fabric scraps are fit into a lattice of diamonds."</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>来看看我们到现在都做了些什么。我们使用 <code>srcset</code> 给浏览器提供了大、中、小版本的图片并用 <code>w</code> 描述符给出了他们的像素宽度。我们通过 <code>sizes</code> 告诉了浏览器它们实际会占多大地方。</p>
<p>如果这是个更简单的例子，我们可以给浏览器一个单一的 CSS 长度值比如 <code>sizes=&quot;100px&quot;</code> 或是 <code>sizes=&quot;50vw&quot;</code>。但是我们没这么幸运。我们得给浏览器<em>两个</em> CSS 长度，同时声明第一个长度只会在满足某个媒体条件时生效。</p>
<p>幸好，这些工作都不是徒劳的。通过使用 <code>srcset</code> 和 <code>sizes</code>，我们给了浏览器选择源图片所需要的一切信息。一旦浏览器获知源图片的像素宽度和 <code>img</code> 的布局宽度，它就会计算源图片相对布局宽度的比例。不妨假设 <code>sizes</code> 返回值为 620px。一个 <code>620w</code> 的源图片会是 <code>img</code> 像素值的一倍。一个 <code>1240w</code> 的源图片则会是两倍。<code>310w</code>？0.5 倍。浏览器算清楚比例，然后选择一个合适的源图片。</p>
<p>值得注意的是，规范允许你直接提供比例数，对没有给出描述符的则默认分配 <code>1x</code>。你可以这么书写：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"standard.jpg"</span> <span class="attr">srcset</span>=<span class="string">"retina.jpg 2x, super-retina.jpg 3x"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>这是一个精巧的提供高 DPI 图像的方法。但是！它只对固定宽度图片有效。在我们的疯狂拼布页面中，所有图片都是流式的，所以我们后面不会再提到 <code>x</code> 描述符了。</p>
<h2 id="来测一下">来测一下</h2>
<p>既然我们<a href="http://alistapart.com/d/407/demo/first-pass.html" target="_blank" rel="noopener">用 <code>srcset</code> 和 <code>sizes</code> 重写了我们的疯狂拼布页面</a>，那么我们在性能上得到了什么？</p>
<p>我们页面的数据量现在根据浏览器条件而（华丽丽地！）不同了。它是变化的，所以我们无法用一个单一的数字来呈现。我在 Chrome 中反复重新加载页面，然后根据不同视口宽度范围的不同数据量画了一个图：</p>
<div class="figure">
<img src="img/first-pass.svg" alt="一幅页面数据量和窗口宽度关系的图表。顶部有一条平线，而下方有一条阶梯式的曲线。"><p class="caption">一幅页面数据量和窗口宽度关系的图表。顶部有一条平线，而下方有一条阶梯式的曲线。</p>
</div>
<p>顶部那条平的灰色线条代表了采用既有技术的数据量 3.5MB。粗的（1x 屏幕）和细的（2x）绿线代表我们采用 <code>srcset</code> 和 <code>sized</code> 后的页面在每 320px 到 1280px 之间每个视口宽度下的数据量。</p>
<p>在 320px 宽的 2x 屏上，我们把数据量削减了<em>三分之二</em>——之前页面总共有 3.5MB；而现在只需要发送 1.1MB 就行了。在 320px 宽的 1x 屏上，我们的页面只有原来的<em>不到十分之一</em>：306kB。</p>
<p>从那里开始，随着我们加载更大源图片来适配更大视口，字节数呈现出阶梯式的上升。在 2x 设备上在大约 350px 视口宽度处有一个显著跃升，然后在 480px 后回到我们使用既有技术手段时的数据量。在 1x 屏幕上，节约量非常显著；960px 之前都可以节省 70%–80% 的原始数据量。之后我们跳升到一个仍然能比初始情况小约 40% 的页面。</p>
<p>这些削减——40%、70%、90%——足够让小伙伴们都惊呆了。我们为每台配备视网膜屏的 iPhone 在加载时砍掉了近 <em>2.5MB</em> 数据量。用毫秒数来衡量一下或是乘上千次 PV，你就会了解这么大费周章是为了什么了。</p>
<h2 id="第二遍picture-和艺术指导">第二遍：<code>picture</code> 和艺术指导</h2>
<blockquote>
<p>懒汉用 <code>srcset</code>，疯子™用 <code>picture</code></p>
<p>—<a href="http://ircbot.responsiveimages.org/bot/log/respimg/2014-06-24#T78853" target="_blank" rel="noopener">Mat Marquis</a></p>
</blockquote>
<p>那么，对于仅仅是需要缩放的图片，我们在 <code>srcset</code> 中列出源图片及其像素宽度，用 <code>sizes</code> 来让浏览器知晓 <code>img</code> 会以什么宽度显示，同时释放我们那<a href="http://alistapart.com/article/dao#section2" target="_blank" rel="noopener">愚蠢的控制欲</a>。但是！有的时候我们会希望通过除了缩放之外的方式来进行图片的自适应。这个时候，我们就需要夺回一些我们选择源图片的控制权。开始说 <code>picture</code>。</p>
<p>我们的细节图有一个很宽的纵横比：16:9。在大屏幕上他们看起来很棒，但在手机上就显得太小了。上面需要展现的缝合与刺绣太小了，以至于无法看清。</p>
<p>如果我们可以在手机上“放大”，展现一个更贴近、更高的裁切图，那就好了。</p>
<div class="figure">
<img src="img/art-direction.gif" alt="一段动画演示，展现了细节图在窄屏上变得多小，而在呈现另一种裁切方式时能得到多少更丰富的细节。"><p class="caption">一段动画演示，展现了细节图在窄屏上变得多小，而在呈现另一种裁切方式时能得到多少更丰富的细节。</p>
</div>
<p>这类工作——剪裁图片<em>内容</em>来适应特定环境——被称为“<a href="http://usecases.responsiveimages.org/#art-direction" target="_blank" rel="noopener">艺术指导</a>”。任何时候我们裁切或是修改图片来适应一个断点（而非简单地缩放整个东西），都是一种艺术指导。</p>
<p>如果我们在一个 <code>srcset</code> 中引入一个裁切版本，我们无法分辨他们何时应该被选用而何时不该选。而用了 <code>picture</code> 和 <code>source media</code>，我们就能明确表达出我们的意图：只在视口宽度超过 36em 时加载宽的矩形版本。在比这个小的视口中，总是加载正方形版本。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">picture</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 16:9 crop --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span></span></span><br><span class="line"><span class="tag">        <span class="attr">media</span>=<span class="string">"(min-width: 36em)"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">srcset</span>=<span class="string">"quilt_2/detail/large.jpg  1920w,</span></span></span><br><span class="line"><span class="tag"><span class="string">                quilt_2/detail/medium.jpg  960w,</span></span></span><br><span class="line"><span class="tag"><span class="string">                quilt_2/detail/small.jpg   480w"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- square crop --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span></span></span><br><span class="line"><span class="tag">        <span class="attr">srcset</span>=<span class="string">"quilt_2/square/large.jpg  822w,</span></span></span><br><span class="line"><span class="tag"><span class="string">                quilt_2/square/medium.jpg 640w,</span></span></span><br><span class="line"><span class="tag"><span class="string">                quilt_2/square/small.jpg  320w"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">        <span class="attr">src</span>=<span class="string">"quilt_2/detail/medium.jpg"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">alt</span>=<span class="string">"Detail of the above quilt, highlighting the embroidery and exotic stitchwork."</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">picture</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>一个 <code>picture</code> 元素包含任意个数的 <code>source</code> 元素和一个 <code>img</code>。浏览器遍历 <code>picture</code> 的 <code>source</code>，直到找到一个属性满足当前环境的 <code>media</code>。它将匹配的 <code>source</code> 的 <code>srcset</code> 传给 <code>img</code>，即那个仍然是我们在页面上“看见”的元素。</p>
<p>下面是一个简单一些的例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">picture</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span> <span class="attr">media</span>=<span class="string">"(orientation: landscape)"</span> <span class="attr">srcset</span>=<span class="string">"landscape.jpg"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"portrait.jpg"</span> <span class="attr">alt</span>=<span class="string">"A rad wolf."</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">picture</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在横屏的视口中，<code>img</code> 将使用 <code>landscape.jpg</code>。当我们在竖屏（或者浏览器不支持 <code>picture</code> 时），<code>img</code> 什么都没变，于是加载 <code>portrait.jpg</code>。</p>
<p>如果你习惯了 <code>audio</code> 和 <code>video</code>，那可能对这种行为会有一些诧异。和这两个元素不同的是，<code>picture</code> 是一个不可见的包装：一个给 <code>img</code> 提供 <code>srcset</code> 的神奇的 <code>span</code>。</p>
<p>换句话说：<code>img</code> 不是一种回退策略。我们把它包裹在一个 <code>picture</code> 内，从而对它进行<em>渐进增强</em>。</p>
<p>事实上，这意味着我们想在渲染出来的图像上应用的任何样式都需要设在 <code>img</code> 上，<em>而非</em> <code>picture</code>。<code>picture { width: 100% }</code> 不会有任何效果。<code>picture &gt; img { width: 100% }</code> 才是你想要的。</p>
<p><a href="http://alistapart.com/d/407/demo/second-pass.html" target="_blank" rel="noopener">这是我们的疯狂拼布页面在完整运用了这种模式之后的样子</a>。记住，我们采用 <code>picture</code> 的目标是给小屏用户提供更多（且更<em>有用</em>）的像素，现在再来看看性能如何：</p>
<div class="figure">
<img src="img/second-pass.svg" alt="另一幅展示页面数据量和窗口宽度关系的图表。"><p class="caption">另一幅展示页面数据量和窗口宽度关系的图表。</p>
</div>
<p>还可以嘛！我们为 1x 屏幕发送了更多字节的数据。但是由于一些<a href="http://blog.cloudfour.com/how-do-you-pick-responsive-images-breakpoints/" target="_blank" rel="noopener">和源图片尺寸有关</a>的复杂原因，我们实际上还扩大了 2x 屏节省数据量的范围。在我们第一遍的方法中到 2x 屏的 480px 宽处就不再有节省了，但在第二遍之后，则延续到了 700px 处。</p>
<p>我们的页面现在小一些的设备上加载更快了，<em>同时</em>看上去也更好了。而且我们还没弄完呢。</p>
<h2 id="第三遍用-source-type-指定多种格式">第三遍：用 <code>source type</code> 指定多种格式</h2>
<p>Web 的 25 年历史都由两种位图格式统治：JPEG 和 GIF。PNG 经过<a href="http://alistapart.com/article/pngopacity" target="_blank" rel="noopener">痛苦</a>的十年时间才加入了这个高端俱乐部。像 <a href="http://en.wikipedia.org/wiki/WebP" target="_blank" rel="noopener">WebP</a> 和 <a href="http://en.wikipedia.org/wiki/JPEG_XR" target="_blank" rel="noopener">JPEG XR</a> 这样的新格式正在外面敲着门，给开发者们许诺更高的压缩率，并且提供诸如 alpha 通道和无损模式等等有用的特性。但由于 <code>img</code> 那个孤单的 <code>src</code>，采纳过程一直都很缓慢——开发者们需要一个格式得到广泛支持后才能用它们进行部署。现在不同了。<code>picture</code> 通过使用和 <code>audio</code> 及 <code>video</code> 相同的 <code>source type</code> 的方式，让提供多个格式变得简单：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">picture</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span> <span class="attr">type</span>=<span class="string">"image/svg+xml"</span> <span class="attr">srcset</span>=<span class="string">"logo.svg"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"logo.png"</span> <span class="attr">alt</span>=<span class="string">"RadWolf, Inc."</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">picture</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果浏览器支持某个 <code>source</code> 的 <code>type</code> 就会把那个 <code>source</code> 的 <code>srcset</code> 提供给 <code>img</code>。</p>
<p>上面是个好理解的例子，但是当我们把 <code>source type</code> 切换再加到我们已有的疯狂拼布的页面上时，比如要加上 WebP 支持，事情就变得麻烦（而且重复）了：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">picture</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 16:9 crop --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"image/webp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">media</span>=<span class="string">"(min-width: 36em)"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">srcset</span>=<span class="string">"quilt_2/detail/large.webp  1920w,</span></span></span><br><span class="line"><span class="tag"><span class="string">                quilt_2/detail/medium.webp  960w,</span></span></span><br><span class="line"><span class="tag"><span class="string">                quilt_2/detail/small.webp   480w"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span></span></span><br><span class="line"><span class="tag">        <span class="attr">media</span>=<span class="string">"(min-width: 36em)"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">srcset</span>=<span class="string">"quilt_2/detail/large.jpg  1920w,</span></span></span><br><span class="line"><span class="tag"><span class="string">                quilt_2/detail/medium.jpg  960w,</span></span></span><br><span class="line"><span class="tag"><span class="string">                quilt_2/detail/small.jpg   480w"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- square crop --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"image/webp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">srcset</span>=<span class="string">"quilt_2/square/large.webp   822w,</span></span></span><br><span class="line"><span class="tag"><span class="string">                quilt_2/square/medium.webp  640w,</span></span></span><br><span class="line"><span class="tag"><span class="string">                quilt_2/square/small.webp   320w"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span></span></span><br><span class="line"><span class="tag">        <span class="attr">srcset</span>=<span class="string">"quilt_2/square/large.jpg   822w,</span></span></span><br><span class="line"><span class="tag"><span class="string">                quilt_2/square/medium.jpg  640w,</span></span></span><br><span class="line"><span class="tag"><span class="string">                quilt_2/square/small.jpg   320w"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">        <span class="attr">src</span>=<span class="string">"quilt_2/detail/medium.jpg"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">alt</span>=<span class="string">"Detail of the above quilt, highlighting the embroidery and exotic stitchwork."</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">picture</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这对于仅仅一个图片来说，代码太多了。而且我们现在要处理很多文件：12 个！<em>每个图片</em>总共有三种分辨率、两种格式、两种裁切版本。我们在性能和功能上的一切收益都是以前期的复杂工作和日后的可维护性作为代价的。</p>
<p><a href="http://blog.cloudfour.com/8-guidelines-and-1-rule-for-responsive-" target="_blank" rel="noopener">自动化是你的好伙伴</a>；当你的页面引入了大量代码块来指向同一个图片的各种替换版本时，你得做好这点，避免手工编写所有东西。</p>
<p>同样也要懂得适可而止。我把规范中的所有工具都用到了我们的例子中。这怎么看都<em>不够</em>谨慎。单独应用这些新特性中的任何一个都可以获得巨大的收益，你应该先认真审视这些特性堆叠起来以后带来的复杂度，再伸<a href="http://saveforwebclaws.tumblr.com/" target="_blank" rel="noopener">爪</a>扑上去做这些杂七杂八的工作。</p>
<p>虽然话是这么说，<a href="http://alistapart.com/d/407/demo/third-pass.html" target="_blank" rel="noopener">还是让我们看一下 WebP 能为我们的拼布做些什么</a>。</p>
<div class="figure">
<img src="img/third-pass.svg" alt="第三幅展示页面数据量和窗口宽度关系的图表。"><p class="caption">第三幅展示页面数据量和窗口宽度关系的图表。</p>
</div>
<p>在我们目前的成果上再节省出 25%–30% 数据量——且不仅在低端，而是覆盖全部情况——绝对不可忽视。我在这里用的方法也不是很严谨；你那边的 WebP 性能可能有所不同。我想说的是：相比现有的 JPEG/GIF/PNG，带来显著收益的新格式已经来了，而且还会有更多。<code>picture</code> 和 <code>source type</code> 降低了门槛，为以后持久的图片格式上的创新铺平了道路。</p>
<h2 id="size-the-day-享受现在sizetheday"><a href="http://meninblazers.wikispaces.com/Size+The+Day" target="_blank" rel="noopener"><code>size</code> the day (享受现在)</a><a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a></h2>
<blockquote>
<p>原木雕后才成器；</p>
<p>[...]</p>
<p>良匠不留未雕之木。</p>
<p>是谓要妙。</p>
<p>—<a href="http://www.chinapage.com/gnl.html#27" target="_blank" rel="noopener">道德经 第 27 章</a><a href="#fn6" class="footnoteRef" id="fnref6"><sup>6</sup></a></p>
</blockquote>
<p>多年来，我们都知道是图片在拖累着响应式的页面。那些巨大的、为巨屏特别设计的、而且被我们发送给<em>每个用户</em>的图片。我们也早就知道怎么来解决这个问题：给每个客户端发送不同的源图片。新的标记帮助我们做的就是这些事情。<code>srcset</code> 让我们给浏览器提供图片的多个版本，然后在 <code>sizes</code> 的帮助下来从中选择最合适的源图片来加载。<code>picture</code> 和 <code>source</code> 让我们实施进一步的控制，来保证根据媒体查询或者文件格式支持情况来选择特定的源图片。</p>
<p>总体上，这些新特性让我们能够编写有适应性、灵活性并且<em>响应式</em>的图片。它们让我们可以根据每个用户的设备发送定制的源图片，使得性能得到巨大的提高。再装备上<a href="http://scottjehl.github.io/picturefill/" target="_blank" rel="noopener">一个超赞的 polyfill</a>，着眼未来，开发者们应该<em>立刻</em>开始使用这些标记！</p>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>《苏菲的选择》讲述了一个二战中的故事。苏菲带着两个年幼的孩子被关进了奥斯维辛集中营，却被告知只能带一个，另一个会被杀死。于是「苏菲的选择」被用来指代两难的境地。<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>polyfill 一词特指为浏览器的新特性提供的向前兼容的程序。<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>所谓的疯狂拼布，是指在不规则拼接的蚕丝布或天鹅绒布上，用刺绣、珠子、缎带、蕾丝等进行装饰。<a href="#fnref3">↩</a></p></li>
<li id="fn4"><p>Kool AD 是美国的一位音乐人，引用部分是歌词，就不进行翻译了（Rap 也不是很好翻译）。<a href="#fnref4">↩</a></p></li>
<li id="fn5"><p>「size the day」是著名足球教练博拉·米卢蒂诺维奇曾经的一个口误，他本想说的是「seize the day」（拉丁文说法 carpe diem，就是享受现在的意思）。这里原文是开了个小玩笑，正好对上文中所讲的 <code>sizes</code> 标签，意思是应当现在就开始享受新特性带来的便利。<a href="#fnref5">↩</a></p></li>
<li id="fn6"><p>原文引用的《道德经》是英文的批注版本，原版中没有前两句话，在这里只是将批注版本直译了一下。（另外，对比南怀瑾的《老子他说》来看，此批注版本的理解也有待商榷。）作者想表达的应该是我们应该尽快物尽其用，把新特性应用到实际开发中去。<a href="#fnref6">↩</a></p></li>
</ol>
</div>

    
</article>

<div class="article-license">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="知识共享许可协议" src="/img/cc-by.png" width="80" height="15"></a>
</div>
<nav class="article-pagination">
    
    <a href="/blog/dissecting-amd-what/" class="article-prev">前一篇: 玩转AMD - 设计思路</a>
    
    
    <a href="/blog/dissecting-amd-preface/" class="article-next">后一篇: 玩转AMD - 写在前面</a>
    
</nav>

<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"32"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

<div class="ds-thread" data-thread-key="blog/responsive-images-in-practice/" data-title="实战响应式图片" data-url="http://efe.baidu.com/blog/responsive-images-in-practice/"></div>
<script>
var duoshuoQuery = {short_name:"baidu-efe"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';
    ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>




<footer>
    <p class="copy">&copy;2018 Baidu EFE | Powered By <a href="http://hexo.io/" target="_blank" title="Hexo">Hexo</a></p>
</footer>

<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F8581b5de0049c5e3009931686fc45d7a' type='text/javascript'%3E%3C/script%3E"));
</script>

</body>
</html>


